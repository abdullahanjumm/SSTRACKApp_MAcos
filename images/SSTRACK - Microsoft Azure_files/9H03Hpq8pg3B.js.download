define("MsPortalImpl/Services/NoSubsChecks",["require","exports","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Services/Services.Permissions","MsPortalImpl/Services/Services.GlobalResourceFilters","Fx/Ajax","MsPortalImpl/UI/UI.AuthStateManager"],(function(e,t,i,r,a,o,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleNoSubsInDirectory=void 0;var n=MsPortalFx.Base,c=MsPortalFx.Hubs.Notifications,l=c.NotificationStatus;const u=n.Diagnostics.createLog(e),f=c.ClientNotification;function d(e){if(MsPortalFx.isFeatureEnabled("disableaadgraphendpoint"))return Promise.resolve(!0);if(!e)return Promise.resolve(!0);const t=new n.UriBuilder((0,o.getEndpoints)().graph);return t.setRelativePath(e+"/isDirectoryFeatureEnabled"),t.query.setParameter("api-version","1.6-internal"),(0,o.ajax)({uri:t.toString(),type:"POST",data:JSON.stringify({directoryFeature:"B2CFeature"}),contentType:"application/json",setAuthorizationHeader:{resourceName:"graph"}}).then((e=>!(!e||!e.value)),(t=>(u.warning("Graph call to check directory {0} for B2C feature failed with error {1}".format(e,t)),!1)))}function p(e){return e.get(r.PermissionsManager).hasPermission("/providers/Microsoft.Intune",["Microsoft.Intune/read"],n.Constants.Shell)}t.handleNoSubsInDirectory=async function(e,t,r,o){const n=t&&t.domainName,c=t&&t.uniqueDirectoryName,u=await o;if(u){const t=await e.getAsync(a.ResourceFilterManager),r=t.currentFilterObservable();if(r)return f.publish({title:i.noSubsNotificationLabel,description:i.noSubsChangingFilterNotificationMessage.format(r.name,i.UiSettings.Flyout.default),uri:"#settings/filters",status:l.Warning}),void t.activateFilter("")}const[g,m,S]=await Promise.all([d(n),p(e),e.get(s.AuthStateManager).getCurrentUser()]);if(r>1&&!g&&!m&&!S.hasAaiClaim&&!window.fx.environment?.notifications?.hideSubscriptionNotifications){const e=(u?i.noFilteredSubsNotificationMessage:i.noSubsNotificationMessage).format(c.replace(/<[a-z/].*?>/gi,""));f.publish({title:i.noSubsNotificationLabel,description:e,uri:"#menu/directory",status:l.Warning,descriptionAsHtml:!1})}return g||m}}));