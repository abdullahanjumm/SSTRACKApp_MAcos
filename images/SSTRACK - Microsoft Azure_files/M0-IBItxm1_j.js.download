define("MsPortalImpl/Auth/MsalJsWrapperV2",["require","exports","@azure/msal-browser-1p-v2"],(function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logoutRedirect=t.getAllAccounts=t.acquireTokenRedirect=t.ssoSilent=t.acquireTokenPopup=t.acquireTokenSilent=t.initialize=t.handleRedirectPromise=t.initializeBrokering=t.initializePublicClientApplication=t.AuthError=t.InteractionRequiredAuthError=t.Configuration=t.AccountInfo=t.AuthenticationScheme=t.AuthenticationResult=t.ExperimentalPublicClientApplication=void 0;var a=MsPortalFx.Base.Diagnostics,n=a.Telemetry;t.ExperimentalPublicClientApplication=i.ExperimentalPublicClientApplication,t.AuthenticationResult=i.AuthenticationResult,t.AuthenticationScheme=i.AuthenticationScheme,t.AccountInfo=i.AccountInfo,t.Configuration=i.Configuration,t.InteractionRequiredAuthError=i.InteractionRequiredAuthError,t.AuthError=i.AuthError;const r=FxImpl.internalEnv,o=a.createLog(e),s=fx.environment.auth,l=i.InteractionType.Redirect,c=window.location.origin;function u(e,t){const a=t||"organizations",s={auth:{clientId:e,authority:(l=r.fxAadAuthority,MsPortalFx.ensureSuffix(l,"/")+a)},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1},system:{loggerOptions:{logLevel:i.LogLevel.Verbose,loggerCallback:(e,t,a)=>{if(MsPortalFx.isFeatureEnabled("enableauthtelemetry")){if(a)return r={action:"MsalLoggerCallbackPii",data:{level:e}},void n.trace({source:"MsalJsWrapper",action:r.action,data:r.data});switch(e){case i.LogLevel.Error:return void o.error(t);case i.LogLevel.Info:case i.LogLevel.Verbose:return void o.verbose(t);case i.LogLevel.Warning:return void o.warning(t)}}var r}}}};var l;return MsPortalFx.isFeatureEnabled("nativebroker")&&(s.system.allowNativeBroker=!0),s}t.initializePublicClientApplication=function(e,i){let a;return a=e===s.portalClientId?{brokerOptions:{actAsBroker:!0,preferredInteractionType:l,brokerMessageTimeout:6e4}}:{brokerOptions:{preferredInteractionType:l,allowBrokering:!0,trustedBrokerDomains:[c],brokerMessageTimeout:6e4}},new t.ExperimentalPublicClientApplication(u(e,i),a,{performanceTelemetryConfiguration:{disabled:!0}})},t.initializeBrokering=async function(e){const{msalObj:t,correlationId:i,spaAuthCode:a,spaAccountId:n}=e;return a?await t.initializeBrokering({codeRequest:{code:a,correlationId:i}}):n?await t.initializeBrokering({codeRequest:{nativeAccountId:n,correlationId:i}}):await t.initializeBrokering()},t.handleRedirectPromise=async function(e,t){return await e.handleRedirectPromise(t)},t.initialize=async function(e){return await e.initialize()},t.acquireTokenSilent=async function(e){const{authority:i,scopes:a,msalObj:n,userAccountInfo:r,correlationId:o,sshTokenData:s,popTokenData:l,claims:c,forceRefresh:u}=e;let p={account:r,scopes:a,authority:i,correlationId:o,claims:c,forceRefresh:u,cacheLookupPolicy:0};return s&&(p={...p,authenticationScheme:t.AuthenticationScheme.SSH,sshJwk:s.jwk,sshKid:s.kid}),l&&(p={...p,...l,authenticationScheme:t.AuthenticationScheme.POP}),MsPortalFx.isFeatureEnabled("nativebroker")&&(p={...p,extraQueryParameters:{webnativebridge:"true"}}),await n.acquireTokenSilent(p)},t.acquireTokenPopup=async function(e){const{scopes:i,msalObj:a,userAccountInfo:n,correlationId:r,sshTokenData:o,popTokenData:s,claims:l}=e;let c={account:n,scopes:i,correlationId:r,claims:l};return o&&(c={...c,authenticationScheme:t.AuthenticationScheme.SSH,sshJwk:o.jwk,sshKid:o.kid}),s&&(c={...c,...s,authenticationScheme:t.AuthenticationScheme.POP}),MsPortalFx.isFeatureEnabled("nativebroker")&&(c={...c,extraQueryParameters:{webnativebridge:"true"}}),await a.acquireTokenPopup(c)},t.ssoSilent=async function(e){const{scopes:i,msalObj:a,userAccountInfo:n,correlationId:r,popTokenData:o}=e;let s={account:n,scopes:i,correlationId:r,...o};return o&&(s={...s,authenticationScheme:t.AuthenticationScheme.POP}),await a.ssoSilent(s)},t.acquireTokenRedirect=async function(e){const{scopes:i,msalObj:a,userAccountInfo:n,correlationId:r,sshTokenData:o,popTokenData:s,claims:l,redirectUri:c}=e;let u={account:n,scopes:i,correlationId:r,claims:l,redirectUri:c};return o&&(u={...u,authenticationScheme:t.AuthenticationScheme.SSH,sshJwk:o.jwk,sshKid:o.kid}),s&&(u={...u,...s}),MsPortalFx.isFeatureEnabled("nativebroker")&&(u={...u,extraQueryParameters:{webnativebridge:"true"}}),await a.acquireTokenRedirect(u)},t.getAllAccounts=function(e){return e.getAllAccounts()},t.logoutRedirect=function(e){return e.msalObj.logoutRedirect({onRedirectNavigate:()=>!1})}})),
define("MsPortalImpl/Services/PortalAuthHandlerV2",["require","exports","Fx/Composition","Fx/Redirect","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Auth/MsalJsWrapperV2","MsPortalImpl/UI/UI.DialogManager"],(function(e,t,i,a,n,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEV=t.MsalClientAuth=void 0;var s=MsPortalFx.Base,l=s.Diagnostics,c=FxImpl.Security,u=l.Telemetry,p=s.Net2,d=s.Resources,h=s.UriBuilder,m=s.QueryStringBuilder;const g=window,f=l.createLog(e),k=MsPortalFx.encodeHtml,x=u.endTrace,A=u.cancelTrace,P=fx.environment,I=P.auth,T=I.portalClientId,w=c.tokenErrors,C=d.getAppRelativeUri("/api/PortalAuthorization/ProvisionServicePrincipal"),M=fx.internalEnv.portalApplicationUri+"/Error",b=n.Shell.Dialogs,S=P.links.aadErrorCodes,y=new Map([["50057:",w.accountDisabled],["50001:",w.appNotProvisioned],["500014:",w.appNotProvisioned],["1001010:",w.appNotProvisioned],["broker_timeout",w.brokerTimeout],["70002:",w.credentialsExpired],["50173:",w.credentialsExpired],["50135:",w.credentialsExpired],["53000:",w.deviceUncompliant],["500113:",w.missingBrokerReplyUrl],["700046:",w.missingBrokerReplyUrl],["50076:",w.requiresMFA],["50078:",w.requiresMFA],["50079:",w.requiresMFA],["50158:",w.requiresMFA],["70008:",w.sessionEnded],["50132:",w.sessionEnded],["70043:",w.sessionEnded],["50020:",w.passthroughUserError]]);let R;try{R=JSON.parse(MsPortalImpl.sessionStorage.getItem("InteractionRequiredErrorSeenMap")||null)||Object.create(null)}catch{R=Object.create(null)}function _(e){u.trace({source:"PortalAuthHandler",action:e.action,actionModifier:e.actionModifier,name:e.name,data:e.data})}function E(e,t){u.trace({source:"PortalAuthHandler",action:t.action,actionModifier:e,data:t.data})}const v=()=>MsPortalFx.isFeatureEnabled("msaljs")||MsPortalFx.isFeatureEnabled("msaljswithfallback");function F(e){return u.start({source:"PortalAuthHandler",action:e.action,name:e.name})}function q(){try{const e=JSON.stringify(R);MsPortalImpl.sessionStorage.setItem("InteractionRequiredErrorSeenMap",e)}catch(e){u.trace({source:"PortalAuthHandler",action:"StoreInteractionRequiredErrorSeenMap",actionModifier:"Failed",data:{error:MsPortalFx.getLogFriendlyMessage(e)}})}}function O(e){if(!e)return null;if(!e.startsWith("Bearer"))return _({action:"parseWwwAuthHeader",data:{reason:"InvalidPrefix",prefix:e.slice(0,7)}}),null;let t="",i="",a="",n=-1;return(e=e.replace("\n",",")).substring(7).split(",").forEach((e=>{const r=/^(.+)="(.*)"$/.exec(e.trim());if(n=r?.length,3===n){const e=r[2];switch(r[1]){case"authorization_uri":t=e;break;case"error":i=e;break;case"claims":a=atob(e)}}})),_({action:"parseWwwAuthHeader",data:{authorization_uri:t,error:i,includesClaims:!!a,regexCount:n}}),a}function z(e,t){let i=Object.create(null);if(e)try{i=JSON.parse(e)}catch(e){_({action:"parsingClaimsFailed",name:t,data:{error:e}})}const a=i.access_token=i.access_token||{},n=a.xms_cc=a.xms_cc||{};return(n.values=n.values||[]).push("cp1"),JSON.stringify(i)}function D(e){const t=(e||{}).message||"";let i=w.unknown;return y.forEach(((e,a)=>{t.includes(a)&&(i=e)})),{status:i,errorMessage:t,authHeader:null,expiresAt:null,expiresInMs:null}}class B{constructor(e,t,i){if(this._authStateManager=e,this._windowManager=t,this._dialogManager=i,this._extensionPCAppCache=new Map,this._modalDialogCopyTextErrors=[],this._portalAppInitRetryCounter=0,this._stalledPromise=null,!v())return;const a=e.bootstrapState,n=e.bootstrapState.user;this._currentTenantId=n.tenantId,this._currentPreferredUsername=n.preferredUsername,this._loginReplyUrlPath=a.loginReplyUrlPath,this._lastRefreshTokenRenewalTime=a.createdOn,this._portalPCAppPromise=this._initializePortalPCApp(),this._portalPCAppPromise.then((e=>{e&&MsPortalImpl.sessionStorage.removeItem("spaAuthCodeRenewed")}))}static getInstance(e,t,i){return B._instance||(B._instance=new B(e,t,i.get(o.DialogManager))),B._instance}async acquireTokenForPortal(e){if(!v())throw"Unsupported function 'acquireTokenForPortal' called with feature.msaljs=false and feature.msaljswithfallback=false.";const{scopes:t,wwwAuthHeader:i,addXmsCcClaim:a,popTokenData:n,isBackground:r}=e,o=F({action:"portalTokenRequest",name:T});let s="";i&&(s=O(i)),a&&(s=z(s,T));const l=await this._portalPCAppPromise,c=this._userAccountInfo;if(!l||!c)return A(o,{reason:"missingPrereqsForTokenRequestForPortal",scopes:t,isPortalPublicClientAppInitialized:!!l,isUserAccountInfoInitialized:!!c,addXmsCcClaim:a,includesWwwAuthHeader:!!i}),null;const u=await this._handleTokenRequest({appId:T,msalClientObject:l},{authority:MsPortalFx.ensureSuffix(FxImpl.internalEnv.fxAadAuthority,"/")+this._currentTenantId,scopes:t,isBackground:r,claims:s,forceRefresh:this._authStateManager.bootstrapState?.forceSignIn,popTokenData:n});return x(o,!!u?.authHeader,{scopes:t,addXmsCcClaim:a,includesWwwAuthHeader:!!i}),u}async acquireTokenForExtension(e){if(!v())throw"Unsupported function 'acquireTokenForExtension' called with feature.msaljs=false and feature.msaljswithfallback=false.";const{extensionClientId:t,scopes:i,tenantId:a,wwwAuthHeader:n,sshTokenData:r,popTokenData:o,addXmsCcClaim:s,isBackground:l}=e,c=this._currentTenantId,u=MsPortalFx.newGuid(),p={scopes:i,extensionClientId:t,customTenantId:a,addXmsCcClaim:s,correlationId:u,includesWwwAuthHeader:!!n,includesSshTokenData:!!r,includesPopTokenData:!!o},d=F({action:"extensionTokenRequest",name:t});let h="";n&&(h=O(n)),s&&(h=z(h,T));const m=this._extensionPCAppCache.get(t);let g=m;if(!g||a!==c)try{g=await this._initializeExtensionPCApp(t,u,a)}catch(e){return{status:w.unknown,errorMessage:e,authHeader:null,expiresAt:null,expiresInMs:null}}const f=this._userAccountInfo;if(!g||!f)return A(d,{reason:"missingPrereqsForTokenRequestForExtension",isExtensionPublicClientAppInitialized:!!g,isUserAccountInfoInitialized:!!f,...p}),null;const k=this._authStateManager.bootstrapState?.forceSignIn||a&&a!==this._currentTenantId,P=await this._handleTokenRequest({appId:t,msalClientObject:g},{authority:MsPortalFx.ensureSuffix(FxImpl.internalEnv.fxAadAuthority,"/")+(a||c),scopes:i,isBackground:l,sshTokenData:r,popTokenData:o,claims:h,forceRefresh:k,customTelemetryData:{isCachedExtensionPublicClientApp:!!m}});return x(d,!!P?.authHeader,p),P}async localLogout(){const e=await this._portalPCAppPromise;return r.logoutRedirect({msalObj:e})}async _initializePortalPCApp(){if(!this._currentTenantId)throw"No tenant ID was passed when initializing the portal public client application using MSAL.js";const e=MsPortalFx.newGuid(),t=F({action:"portalAppInit",name:T});let i="PortalAuthHandler.UnkownError";const n=r.initializePublicClientApplication(T,this._currentTenantId);MsPortalFx.isFeatureEnabled("nativebroker")&&(f.verbose("[Native broker] InitializePortalPCApp - Before calling initialize"),await r.initialize(n),f.verbose("[Native broker] InitializePortalPCApp - Initialize complete"));try{const i=this._authStateManager.bootstrapState.spaAuthCode;let a;f.verbose("[Native broker] InitializePortalPCApp - Before calling initializeBrokering"),await r.initializeBrokering({msalObj:n,correlationId:e,spaAuthCode:i}),f.verbose("[Native broker] InitializePortalPCApp - initializeBrokering complete"),i&&this._authStateManager.clearSpaAuthCode();try{const e=JSON.parse(MsPortalImpl.sessionStorage.getItem("Redirect_BootParameters")||"{}");e.msalHash&&(a=e.msalHash,MsPortalImpl.sessionStorage.setItem("Redirect_BootParameters",JSON.stringify({...e,msalHash:""})))}catch(e){}const c=await r.handleRedirectPromise(n,a);if(c){if(c.account)return x(t,!0,{reason:"portalAppInit_CompleteViaRedirectPromise",correlationId:e}),this._userAccountInfo=c.account,n;f.error("Calling 'handleRedirectPromise' returned an AuthenticationResult object with a missing 'account' property. This is an error in the MSAL.js library.")}else{const i=(o=r.getAllAccounts(n),s=this._currentTenantId,l=this._currentPreferredUsername,o&&o.length>0?MsPortalFx.find(o,(e=>e.tenantId===s&&e.username===l)):null);if(i)return x(t,!0,{reason:"portalAppInit_CompleteViaAccountsSearch",correlationId:e}),this._userAccountInfo=i,n}}catch(n){i=(n.message||n).replace(/<.*?>/g,"[REDACTED_TEXT]");const r=++this._portalAppInitRetryCounter,o=MsPortalImpl.sessionStorage.getItem("spaAuthCodeRenewed");if(A(t,{reason:`portalAppInit_Failed_${r}`,correlationId:e,spaAuthCodeRenewed:o,exceptionMessage:i}),i.includes("AADSTS70008:")){if(!o)return MsPortalImpl.sessionStorage.setItem("spaAuthCodeRenewed","true"),await a.forceSignIn({reason:"Renew the SPA auth code in this user's session."}),null}else if(r<=3)return await this._initializePortalPCApp()}var o,s,l;const c=new h(M);return c.path+="/SigninFailed",c.fragment=window.location.hash,c.query=(new m).setParameters({aadAuthority:FxImpl.internalEnv.fxAadAuthority,aadErrorDetails:i}),MsPortalImpl.sessionStorage.removeItem("spaAuthCodeRenewed"),this._windowManager.redirect({uri:c.toString(),redirectAction:3,reason:"PortalAppInitFailed"}),null}async _initializeExtensionPCApp(e,t,i){const a=await this._portalPCAppPromise,n=this._userAccountInfo,o={extensionClientId:e,correlationId:t},s=F({action:"extensionAppInit",name:e});if(!a||!n)return _({action:"missingPrereqsForExtensionInit",name:e,data:{isPortalPublicClientAppInitialized:!!a,isUserAccountInfoInitialized:!!n}}),null;const l=r.initializePublicClientApplication(e,i||this._currentTenantId);MsPortalFx.isFeatureEnabled("nativebroker")&&(f.verbose(`[Native broker] InitializeExtensionPCApp - ${e} - Before calling initialize`),await r.initialize(l),f.verbose(`[Native broker] InitializeExtensionPCApp - ${e} - initialize complete`));try{return f.verbose(`[Native broker] InitializeExtensionPCApp - ${e} - Before calling initializeBrokering`),await r.initializeBrokering({msalObj:l,correlationId:t}),f.verbose(`[Native broker] InitializeExtensionPCApp - ${e} - initializeBrokering complete`),await r.handleRedirectPromise(l),i||this._extensionPCAppCache.set(e,l),x(s,!0,o),l}catch(t){throw x(s,!1,o),new MsPortalFx.Errors.Error({message:`Initialization of extension '${e}' has failed with the following error: `+MsPortalFx.getLogFriendlyMessage(t),innerErrors:t})}}async _handleTokenRequest(e,t){const{appId:i}=e,a=await this._handleTokenRequestHelper(e,t,this._userAccountInfo,this._loginReplyUrlPath);return a.status===w.appNotProvisioned&&!t.scopes.some((e=>e.includes(I.armAadResource)))&&i!==T&&await async function(e){const t=F({action:"ProvisionServicePrincipal",name:e});let i="";try{i=(await p.postJSON({uri:C,dataType:"json",setAuthorizationHeader:!0,performRetry:!1},{extensionClientId:e})).errorMessage}catch(t){i=`Failed to provision service principal for the extension application '${e}' in the current tenant.Details: ${MsPortalFx.getLogFriendlyMessage(t)}.`}const a=!i;return x(t,a,{extensionClientId:e,errorMessage:i}),a}(i)?await this._handleTokenRequestHelper(e,t,this._userAccountInfo,this._loginReplyUrlPath):a}async _handleTokenRequestHelper(e,t,a,n){const{msalClientObject:o}=e,{authority:s,customTelemetryData:l,claims:c,sshTokenData:u,popTokenData:p,forceRefresh:d,isBackground:h}=t,m=t.scopes||p.scopes,{clientId:f,clientCapabilities:A}=o.getConfiguration().auth,P=Date.now()-this._lastRefreshTokenRenewalTime>=432e5,I=MsPortalFx.newGuid(),C={authority:s,clientCapabilities:A,clientId:f,correlationId:I,includesPopTokenData:!!p,includesSshTokenData:!!u,lastRefreshTokenRenewalTime:this._lastRefreshTokenRenewalTime,useSsoSilent:P,scopes:m},M={msalObj:o,correlationId:I,authority:s,scopes:m,userAccountInfo:a,claims:c,sshTokenData:u,popTokenData:p,forceRefresh:d},y=(e,t,i,a,n)=>{E("authorized",{action:"tokenRequestSuccess",data:{...C,...l,tokenFetchMethod:i,includesAccessToken:e,tokenType:t,expiresOn:a,expiresInMs:a?a.getTime()-Date.now():void 0,extExpiresOn:n,extExpiresInMs:n?n.getTime()-Date.now():void 0}})},v=e=>{E("unauthorized",{action:"tokenRequestFailure",data:{...C,...l,exceptionErrorCode:e.errorCode,exceptionErrorMessage:e.message,exceptionMessage:e.message,exceptionStack:e.stack}})},O=async e=>{if(this._stalledPromise){_({action:e,actionModifier:"BeginWait"});const t=await this._stalledPromise;return _({action:e,actionModifier:"EndWait"}),t}return null};await O("beforeAcquireTokenSilentCall");let z="";try{let e;z=F({action:"acquireTokenSilent",name:f}),p||P?(P&&(this._lastRefreshTokenRenewalTime=Date.now(),M.forceRefresh=!0),e=await r.ssoSilent(M)):e=await r.acquireTokenSilent(M),y(!!e.accessToken,e.tokenType,"acquireTokenSilent",e.expiresOn,e.extExpiresOn),x(z,!0,{tokenType:e.tokenType,scope:m[0],expiresOn:e.expiresOn,extExpiresOn:e.extExpiresOn,fromCache:e.fromCache,pageVisible:this._authStateManager.getPageVisibility()});const t=m[0].slice(0,-9);if(!await FxImpl.Security.validateTokenClaims({token:`${e.tokenType} ${e.accessToken}`,expectedClaims:{aud:t,appId:f},msalExpiresAtInMs:e.expiresOn.getTime(),telemetrySource:"PortalAuthHandler_1"})){this.localLogout(),e=await r.acquireTokenSilent(M);const i=await FxImpl.Security.validateTokenClaims({token:`${e.tokenType} ${e.accessToken}`,expectedClaims:{aud:t,appId:f},msalExpiresAtInMs:e.expiresOn.getTime(),telemetrySource:"PortalAuthHandler_2"});y(!!e.accessToken,e.tokenType,"acquireTokenSilent_RepeatedCall",e.expiresOn,e.extExpiresOn),_({action:"acquireTokenSilent_RepeatedCall",actionModifier:i?"valid":"invalidExpiration",data:{scope:m[0],tokenType:e.tokenType,expiresOn:e.expiresOn,extExpiresOn:e.extExpiresOn,fromCache:e.fromCache,pageVisible:this._authStateManager.getPageVisibility()}})}const{accessToken:i,expiresOn:a,tokenType:n}=e;return{authHeader:`${n} ${i}`,expiresAt:a.getTime(),expiresInMs:a.getTime()-Date.now()}}catch(e){let t=e;if(v(t),x(z,!1,{scope:m[0],pageVisible:this._authStateManager.getPageVisibility()}),h)return{status:w.unknown,errorMessage:t.message,authHeader:null,expiresAt:null,expiresInMs:null};let a=t.message.includes("AADSTS700084:");if(a){let e="";try{e=F({action:"ssoSilent_RefreshTokenExpired",name:f});const t=await r.ssoSilent(M),{accessToken:i,expiresOn:a,extExpiresOn:n,tokenType:o,fromCache:s}=t;return y(!!i,o,"ssoSilent_RefreshTokenExpired",a,n),x(e,!0,{scope:m[0],tokenType:o,fromCache:s,pageVisible:this._authStateManager.getPageVisibility()}),{authHeader:`${o} ${i}`,expiresAt:a.getTime(),expiresInMs:a.getTime()-Date.now()}}catch(i){v(i),x(e,!1,{scope:m[0],pageVisible:this._authStateManager.getPageVisibility()}),t=i,a=i.message.includes("AADSTS700084:")}}const o=t instanceof r.InteractionRequiredAuthError;if(o||a){const e=k(t.message),s=async()=>{_({action:"detectedInteractionRequiredAuthError",data:{isRefreshTokenExpired:a}});const o=Promise.withResolvers(),s=Object.create(null);if(S&&(s.learnMoreText=b.learnMore,s.onClickLearnMore=new i.ClickableLink(S,"_blank",null,MsPortalFx.noop,"AadErrorCodes")),this._modalDialogCopyTextErrors.push({errorMessage:e,clientId:f,scopes:m}),this._stalledPromise){const e=await O("uponConsecutiveInteractionRequiredError");if(4!==e.dialogResult)return{dialogResult:e.dialogResult,tokenResult:{status:w.unknown,errorMessage:t.message,authHeader:null,expiresAt:null,expiresInMs:null}}}_({action:"displayingModalDialog",data:{scope:m[0]}});const l=await this._dialogManager.showModalDialog({title:b.claimsErrorGenericTitle,description:b.claimsErrorGenericDescription.format(`${e}`,S?'<a class="msportalfx-ext-link" href="" data-bind="text: learnMoreText, fxclick: onClickLearnMore"></a>':"")+'<div class="fxt-copy"><a href="#" data-bind="text: copyText, click: copyClick"></a></div>',templateViewModel:MsPortalFx.extend2(s,{copyText:b.copyText,copyClick:()=>{const e=FxImpl.createElement("pre");e.textContent=JSON.stringify({sessionId:MsPortalFx.sessionId,errors:this._modalDialogCopyTextErrors},null,2),document.body.appendChild(e);const t=g.getSelection();t.removeAllRanges();const i=document.createRange();i.selectNodeContents(e),t.addRange(i),g.document.execCommand("copy"),e.remove()}}),defaultButtonText:b.claimsErrorButtonText,cancelButtonText:b.connectionErrorCancelButtonText,buttons:2,uiShield:{hidePromise:o.promise}});if(this._modalDialogCopyTextErrors=[],4!==l)return o.resolve(),{dialogResult:l,tokenResult:{status:w.unknown,errorMessage:t.message,authHeader:null,expiresAt:null,expiresInMs:null}};_({action:"initiatingAcquireTokenRedirect",data:{scope:m[0]}}),MsPortalImpl.sessionStorage.setItem("forceSignIn","true"),this._authStateManager.clear();try{if(f.toLowerCase()===T)return await r.acquireTokenRedirect({...M,redirectUri:n}),null;const{accessToken:e,expiresOn:t,extExpiresOn:i,tokenType:a}=await r.acquireTokenPopup(M);return y(!!e,a,"acquireTokenPopup",t,i),{dialogResult:l,tokenResult:{authHeader:`${a} ${e}`,expiresAt:t.getTime(),expiresInMs:t.getTime()-Date.now()}}}catch(e){return v(e),{dialogResult:l,tokenResult:D(e)}}};if(MsPortalFx.isFeatureEnabled("msaljswithfallback")&&!p&&!u&&o){if(R[f]=R[f]?R[f]:Object.create(null),R[f][m[0]])return R[f][m[0]]=null,q(),D(t);R[f][m[0]]=!0,q()}this._stalledPromise=s();const l=await this._stalledPromise;return this._stalledPromise=null,l.tokenResult}return D(t)}}}t.MsalClientAuth=B}));